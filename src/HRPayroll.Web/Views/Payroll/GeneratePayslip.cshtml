@model HRPayroll.Web.Models.PayslipViewModel

@{
    ViewData["Title"] = "Payslip Generation";
    Layout = "_Layout";
}

    <div class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <form asp-action="GeneratePayslip" method="get">
                                <div class="row">
                                    <div class="col-md-3">
                                        <select name="employeeId" class="form-control" asp-items="ViewBag.Employees">
                                            <option value="">Select Employee</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select name="month" class="form-control" asp-items="ViewBag.MonthList">
                                            <option value="">Select Month</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select name="year" class="form-control" asp-items="ViewBag.YearList">
                                            <option value="">Select Year</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-search mr-2"></i>Generate
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="card-body">
                            @if (ViewBag.Error != null)
                            {
                                <div class="alert alert-warning">@ViewBag.Error</div>
                            }

                            @if (Model != null && Model.EmployeeId > 0)
                            {
                                <div class="invoice p-3 mb-3" id="payslip-content">
                                    <div class="row">
                                        <div class="col-12">
                                            <h4>
                                                <i class="fas fa-building"></i> HR & Payroll Management System
                                                <small class="float-right">Date: @DateTime.Now.ToString("yyyy-MM-dd")</small>
                                            </h4>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row invoice-info">
                                        <div class="col-sm-4 invoice-col">
                                            <strong>Employee Details</strong>
                                            <address>
                                                <strong>@Model.EmployeeName</strong><br>
                                                Employee ID: @Model.EmployeeCode<br>
                                                Department: @Model.Department<br>
                                                Designation: @Model.Designation<br>
                                                Join Date: @(Model.JoinDate?.ToString("yyyy-MM-dd") ?? "N/A")
                                            </address>
                                        </div>
                                        <div class="col-sm-4 invoice-col">
                                            <strong>Pay Period</strong>
                                            <address>
                                                Month: @Model.MonthName @Model.Year<br>
                                                Working Days: @Model.WorkingDays<br>
                                                Days Present: @Model.DaysPresent<br>
                                                Days Absent: @Model.DaysAbsent
                                            </address>
                                        </div>
                                        <div class="col-sm-4 invoice-col">
                                            <strong>Bank Details</strong>
                                            <address>
                                                Bank Name: @Model.BankName<br>
                                                Account Number: @Model.BankAccountNo<br>
                                                Branch: @Model.BranchName
                                            </address>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <p class="lead">Earnings</p>
                                            <table class="table table-striped">
                                                <tr>
                                                    <th>Description</th>
                                                    <th>Amount</th>
                                                </tr>
                                                <tr>
                                                    <td>Basic Salary</td>
                                                    <td>@Model.BasicSalary.ToString("N2")</td>
                                                </tr>
                                                <tr>
                                                    <td>House Rent Allowance</td>
                                                    <td>@Model.HouseRentAllowance.ToString("N2")</td>
                                                </tr>
                                                <tr>
                                                    <td>Transport Allowance</td>
                                                    <td>@Model.TransportAllowance.ToString("N2")</td>
                                                </tr>
                                                <tr>
                                                    <td>Medical Allowance</td>
                                                    <td>@Model.MedicalAllowance.ToString("N2")</td>
                                                </tr>
                                                @if (Model.OvertimeAmount > 0)
                                                {
                                                    <tr>
                                                        <td>Overtime</td>
                                                        <td>@Model.OvertimeAmount.ToString("N2")</td>
                                                    </tr>
                                                }
                                                <tr>
                                                    <td><strong>Total Earnings</strong></td>
                                                    <td><strong>@Model.TotalEarnings.ToString("N2")</strong></td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="col-6">
                                            <p class="lead">Deductions</p>
                                            <table class="table table-striped">
                                                <tr>
                                                    <th>Description</th>
                                                    <th>Amount</th>
                                                </tr>
                                                @if (Model.ProvidentFund > 0)
                                                {
                                                    <tr>
                                                        <td>Provident Fund</td>
                                                        <td>@Model.ProvidentFund.ToString("N2")</td>
                                                    </tr>
                                                }
                                                @if (Model.TaxDeduction > 0)
                                                {
                                                    <tr>
                                                        <td>Tax Deduction</td>
                                                        <td>@Model.TaxDeduction.ToString("N2")</td>
                                                    </tr>
                                                }
                                                @if (Model.Insurance > 0)
                                                {
                                                    <tr>
                                                        <td>Insurance</td>
                                                        <td>@Model.Insurance.ToString("N2")</td>
                                                    </tr>
                                                }
                                                @if (Model.OtherDeductions > 0)
                                                {
                                                    <tr>
                                                        <td>Other Deductions</td>
                                                        <td>@Model.OtherDeductions.ToString("N2")</td>
                                                    </tr>
                                                }
                                                <tr>
                                                    <td><strong>Total Deductions</strong></td>
                                                    <td><strong>@Model.TotalDeductions.ToString("N2")</strong></td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="table-responsive">
                                                <table class="table">
                                                    <tr>
                                                        <th>Gross Salary</th>
                                                        <td>@Model.GrossSalary.ToString("N2")</td>
                                                        <th>Total Deductions</th>
                                                        <td>@Model.TotalDeductions.ToString("N2")</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Net Salary</th>
                                                        <td><strong class="text-success">@Model.NetSalary.ToString("N2")</strong></td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-primary" onclick="window.print()">
                                        <i class="fas fa-print mr-2"></i>Print Payslip
                                    </button>
                                    <button class="btn btn-success" disabled title="PDF generation coming soon">
                                        <i class="fas fa-file-pdf mr-2"></i>Download PDF
                                    </button>
                                    <button class="btn btn-info" disabled title="Email feature coming soon">
                                        <i class="fas fa-envelope mr-2"></i>Send via Email
                                    </button>
                                </div>
                            }
                            else
                            {
                                <div class="text-center py-5">
                                    <i class="fas fa-file-invoice-dollar fa-4x text-muted mb-3"></i>
                                    <p class="text-muted">Select an employee and month to generate payslip</p>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


@section Scripts {
    <script>
        // Set default values if not provided
        $(document).ready(function () {
            // If month/year not selected, default to current month/year
            if (!$('select[name="month"]').val()) {
                $('select[name="month"]').val(new Date().getMonth() + 1);
            }
            if (!$('select[name="year"]').val()) {
                $('select[name="year"]').val(new Date().getFullYear());
            }
        });
    </script>
}
